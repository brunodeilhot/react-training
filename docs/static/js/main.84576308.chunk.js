(this["webpackJsonpreact-training"]=this["webpackJsonpreact-training"]||[]).push([[0],{213:function(e,t,r){},214:function(e,t,r){},215:function(e,t,r){},216:function(e,t,r){"use strict";r.r(t);var c=r(0),a=r.n(c),s=r(32),n=r.n(s),i=r(4),o=r(85),u=r(5),l=r(2),d=r(79),j=r.n(d).a.create({baseURL:"https://bdeilhot-react.herokuapp.com",headers:{Accept:"application/json","Content-Type":"application/json"}});function b(e){if(e.status>=200&&e.status<300)return e;var t=new Error("HTTP Error ".concat(e.statusText));throw console.log(t),t}function O(e){return e.data}var h={getUsers:function(e){return j.get("/users").then(b).then(O).then(e)},getStories:function(e){return j.get("/stories").then(b).then(O).then(e)},createStory:function(e){return j.post("/stories",e).then(b)},createUser:function(e){return j.post("/users",e).then(b)},deleteStory:function(e){return j.delete("/stories?id=eq.".concat(e)).then(b)},updateStory:function(e){return j.put("/stories?id=eq.".concat(e.id),e).then(b)}};var m=Object(o.a)((function(e,t){switch(t.type){case"FETCH_STORIES_SUCCESS":return Object(l.a)(Object(l.a)({},e),{},{stories:t.payload,loading:!1});case"FETCH_USER_SUCCESS":return Object(l.a)(Object(l.a)({},e),{},{users:t.payload});case"ADD_USER":return h.createUser(t.user),Object(l.a)(Object(l.a)({},e),{},{users:[].concat(Object(u.a)(e.users),[t.user])});case"ADD_STORY":return h.createStory(t.story),Object(l.a)(Object(l.a)({},e),{},{stories:[].concat(Object(u.a)(e.stories),[t.story]),updateArticles:!0});case"REMOVE_STORY":var r=e.stories.findIndex((function(e){return e.id===t.story.id}));return e.stories.splice(r,1),Object(l.a)(Object(l.a)({},e),{},{stories:Object(u.a)(e.stories)});case"UPDATE_STORY":var c=e.stories.findIndex((function(e){return e.id===t.story.id}));return e.stories.splice(c,1,t.story),h.updateStory(t.story),Object(l.a)(Object(l.a)({},e),{},{stories:Object(u.a)(e.stories)});case"STOP_ARTICLE_UPDATE":return Object(l.a)(Object(l.a)({},e),{},{updateArticles:!1});case"SEARCH_OPTION_CHANGE":return Object(l.a)(Object(l.a)({},e),{},{searchOption:t.payload});case"SEARCH_VALUE_CHANGE":return Object(l.a)(Object(l.a)({},e),{},{searchValue:t.payload});default:return e}}),{users:[],stories:[],updateArticles:!1,loading:!0,searchOption:"title",searchValue:""}),f=r(16),x=r.n(f),p=r(1),y=function(e){var t=e.name,r=e.picture,c=e.joined;return Object(p.jsxs)("div",{className:"col-2-30 avatar",children:[Object(p.jsxs)("div",{children:[Object(p.jsx)("img",{src:r,alt:"Avatar"}),Object(p.jsx)("span",{children:t})]}),Object(p.jsx)("div",{className:"meta",children:Object(p.jsxs)("p",{children:["Joined ",x()(c).fromNow()]})})]})},v=r(33),S=r(6),g=r(9),N=function(e){var t=e.id,r=e.title,a=e.story,s=e.created,n=e.edited,o=e.author,u=Object(i.b)(),d=Object(c.useState)(!1),j=Object(S.a)(d,2),b=j[0],O=j[1],m=Object(c.useState)(!1),f=Object(S.a)(m,2),y=f[0],N=f[1],E=Object(c.useState)({title:r,story:a}),C=Object(S.a)(E,2),T=C[0],A=C[1],_=Object(c.useState)(""),R=Object(S.a)(_,2),U=R[0],D=R[1],w=Object(c.useState)(""),H=Object(S.a)(w,2),q=H[0],F=H[1],L=new Date,k=g.a({title:g.b().min(5,"Must be 5 characters or more").max(50,"Must be 50 characters or less").required("Title is required"),story:g.b().min(100,"Must be 100 characters or more").required("Story is required")});return Object(p.jsxs)("div",{className:"col-2-70 story",children:[Object(p.jsxs)("div",{className:"title",children:[!0===y?Object(p.jsx)("input",{type:"text",value:T.title,onChange:function(e){var t=e.target.value;return A({title:t,story:T.story})},className:"input ".concat(""===U?"":"error-border")}):Object(p.jsx)("h2",{children:r}),Object(p.jsx)("p",{className:"error-message",children:""===U?null:U})]}),Object(p.jsxs)("div",{className:"message",children:[!0===y?Object(p.jsx)("textarea",{value:T.story,onChange:function(e){var t=e.target.value;return A({title:T.title,story:t})},className:"textarea ".concat(""===q?"":"error-border")}):Object(p.jsx)("p",{children:a}),Object(p.jsx)("p",{className:"error-message",children:""===q?null:q})]}),Object(p.jsxs)("div",{className:"article-footer meta",children:[Object(p.jsxs)("p",{children:[n===s?"Created ".concat(x()(s).fromNow()):"Edited ".concat(x()(n).fromNow())," "]}),Object(p.jsx)("button",{onClick:function(){!0!==y?N(!1===y):k.validate({title:T.title,story:T.story},{abortEarly:!1}).catch((function(e){var t=e.inner.map((function(e){return[e.path,e.message]})).reduce((function(e,t){var r=Object(S.a)(t,2),c=r[0],a=r[1];return Object(l.a)(Object(l.a)({},e),{},Object(v.a)({},c,c in e?[].concat(e[c],a):[a]))}),{}),r=t.title?t.title.join(" and ").toString():"",c=t.story?t.story.join(" and ").toString():"";D(r),F(c)})).then((function(e){e&&(u({type:"UPDATE_STORY",story:{id:t,title:T.title,story:{story:T.story},created:s,edited:L,author:o}}),N(!1===y))}))},className:"bt bt-left ".concat(!0===y?"bt-active":""),children:"Edit"}),Object(p.jsx)("button",{onClick:function(){O(!1===b)},className:"bt bt-right",children:"Delete"})]}),!0===b?Object(p.jsxs)("div",{className:"delete-confirm",children:[Object(p.jsx)("p",{children:"Are you sure?"}),Object(p.jsxs)("div",{children:[Object(p.jsx)("button",{onClick:function(){h.deleteStory(t),u({type:"REMOVE_STORY",story:{id:t}}),O(!1)},className:"bt bt-left",children:"Yes"}),Object(p.jsx)("button",{onClick:function(){return O(!1)},className:"bt bt-right",children:"No"})]})]}):null]})},E=(r(213),function(e){var t=e.id,r=e.title,c=e.author,a=e.story,s=e.created,n=e.edited,o=Object(i.c)((function(e){return e.users})).filter((function(e){return e.id===c})),u=Object(l.a)({},o[0]);return Object(p.jsxs)("div",{className:"article",children:[Object(p.jsx)(y,{name:u.name,picture:u.picture,joined:u.joined}),Object(p.jsx)(N,{id:t,title:r,story:a,created:s,edited:n,author:c})]})}),C=function(){return Object(p.jsx)("div",{className:"loading",children:Object(p.jsxs)("div",{className:"lds-ellipsis",children:[Object(p.jsx)("div",{}),Object(p.jsx)("div",{}),Object(p.jsx)("div",{}),Object(p.jsx)("div",{})]})})},T=function(){var e=Object(i.b)(),t=Object(i.c)((function(e){return e.users})),r=Object(i.c)((function(e){return e.stories})),a=Object(i.c)((function(e){return e.updateArticles})),s=Object(i.c)((function(e){return e.loading})),n=Object(i.c)((function(e){return e.searchOption})),o=Object(i.c)((function(e){return e.searchValue}));Object(c.useEffect)((function(){h.getStories((function(t){return e({type:"FETCH_STORIES_SUCCESS",payload:t})})),h.getUsers((function(t){return e({type:"FETCH_USER_SUCCESS",payload:t})})),e({type:"STOP_ARTICLE_UPDATE"}),console.log("fetch story effect")}),[e,a]);var u=t.filter((function(e){return e.name===o})),d=""===o?r.sort((function(e,t){return t.created>e.created?1:-1})).map((function(e){return Object(p.jsx)(E,{id:e.id,title:e.title,author:e.author,story:e.story.story,created:e.created,edited:e.edited},e.id)})):r.sort((function(e,t){return t.created>e.created?1:-1})).filter("title"===n?function(e){return e.title.toLocaleLowerCase().includes(o.toLocaleLowerCase())}:function(e){return e.author===Object(l.a)({},u[0]).id}).map((function(e){return Object(p.jsx)(E,{id:e.id,title:e.title,author:e.author,story:e.story.story,created:e.created,edited:e.edited},e.id)}));return Object(p.jsxs)(p.Fragment,{children:[s?Object(p.jsx)(C,{}):null,Object(p.jsx)("div",{className:"article-list",children:d})]})},A=r(8),_=function(){var e=Object(i.b)(),t=Object(i.c)((function(e){return e.users})),r=Object(i.c)((function(e){return e.stories})),a=Object(c.useState)(!0),s=Object(S.a)(a,2),n=s[0],o=s[1],u=new Date,d={username:"",avatar:"",title:"",story:""};function j(e){if(t.find((function(t){return t.name===e}))){var r=t.filter((function(t){return t.name===e}));return Object(l.a)({},r[0])}return!1}function b(){return t.length+1}function O(){return 0===r.length?1:r[0].id+1}function h(){o(!n)}return Object(p.jsx)(A.d,{initialValues:d,validationSchema:g.a({username:g.b().max(15,"Must be 15 characters or less").required("Username is required"),avatar:g.b().url("Avatar must be a valid URL"),title:g.b().max(50,"Must be 50 characters or less").required("Title is required"),story:g.b().min(100,"Must be 100 characters or more").required("Story is required")}),onSubmit:function(t,r){var c=r.setSubmitting,a=r.resetForm;setTimeout((function(){var r=j(t.username);r?e({type:"ADD_STORY",story:{id:O(),title:t.title,author:r.id,story:{story:t.story},created:u,edited:u}}):(e({type:"ADD_USER",user:{id:b(),name:t.username,picture:t.avatar=t.avatar,joined:u}}),e({type:"ADD_STORY",story:{id:O(),title:t.title,author:b(),story:{story:t.story},created:u,edited:u}})),c(!1),a()}),400)},children:function(e){var t=e.isSubmitting,r=e.setFieldValue;return Object(p.jsxs)("div",{className:"article-form-group",children:[Object(p.jsxs)("div",{className:"article-header",children:[Object(p.jsx)("h2",{children:"Create a story"}),Object(p.jsx)("button",{onClick:h,children:Object(p.jsx)("i",{className:n?"gg-chevron-down":"gg-chevron-up"})})]}),n?null:Object(p.jsxs)(A.c,{className:"article-form",children:[Object(p.jsxs)("div",{className:"row",children:[Object(p.jsxs)("div",{className:"col-2-30",children:[Object(p.jsx)("label",{htmlFor:"username",children:"Username"}),Object(p.jsx)(A.b,{name:"username",children:function(e){var t=e.field,c=e.meta,a=c.touched,s=c.error;return Object(p.jsx)("input",Object(l.a)({onKeyUp:function(e){!function(e){var t=j(e.target.value);t&&(d.avatar=t.picture)}(e),r("avatar",d.avatar,!0)},placeholder:"Your name is..",type:"text",className:a&&s?"input error-border":"input"},t))}}),Object(p.jsx)(A.a,{className:"error-message",name:"username",component:"div"}),Object(p.jsx)("label",{htmlFor:"avatar",children:"Avatar"}),Object(p.jsx)(A.b,{name:"avatar",children:function(e){var t=e.field,r=e.meta,c=r.touched,a=r.error;return Object(p.jsx)("input",Object(l.a)({placeholder:"Link to an image..",type:"text",className:c&&a?"input error-border":"input"},t))}}),Object(p.jsx)(A.a,{className:"error-message",name:"avatar",component:"div"})]}),Object(p.jsxs)("div",{className:"col-2-70",children:[Object(p.jsx)("label",{htmlFor:"title",children:"Title"}),Object(p.jsx)(A.b,{name:"title",children:function(e){var t=e.field,r=e.meta,c=r.touched,a=r.error;return Object(p.jsx)("input",Object(l.a)({placeholder:"The main subject of your story..",type:"text",className:c&&a?"input error-border":"input"},t))}}),Object(p.jsx)(A.a,{className:"error-message",name:"title",component:"div"}),Object(p.jsx)("label",{htmlFor:"story",children:"Story"}),Object(p.jsx)(A.b,{name:"story",children:function(e){var t=e.field,r=e.meta,c=r.touched,a=r.error;return Object(p.jsx)("textarea",Object(l.a)({placeholder:"Write to your hearth's delight..",className:c&&a?"textarea error-border":"textarea"},t))}}),Object(p.jsx)(A.a,{className:"error-message",name:"story",component:"div"})]})]}),Object(p.jsx)("button",{type:"submit",disabled:t,children:"Add Story"})]})]})}})},R=function(){var e=Object(i.b)();return Object(p.jsxs)("div",{className:"search",children:[Object(p.jsxs)("select",{onChange:function(t){e({type:"SEARCH_OPTION_CHANGE",payload:t.target.value})},className:"search-select",children:[Object(p.jsx)("option",{value:"title",children:"Title"}),Object(p.jsx)("option",{value:"author",children:"Author"})]}),Object(p.jsx)("div",{children:Object(p.jsx)("i",{className:"gg-search"})}),Object(p.jsx)("input",{onChange:function(t){e({type:"SEARCH_VALUE_CHANGE",payload:t.target.value})},className:"input",type:"text"})]})},U=(r(214),function(){return Object(p.jsxs)("div",{className:"dashboard",children:[Object(p.jsx)(_,{}),Object(p.jsx)(R,{}),Object(p.jsx)(T,{})]})}),D=(r(215),function(){return Object(p.jsxs)("div",{className:"container",children:[Object(p.jsx)("div",{className:"header",children:Object(p.jsx)("h1",{children:"Share your story!"})}),Object(p.jsx)(U,{}),Object(p.jsx)("div",{className:"footer",children:Object(p.jsxs)("p",{children:["Designed and built by Bruno Deilhot \xa9 ",x()().year()]})})]})});n.a.render(Object(p.jsx)(i.a,{store:m,children:Object(p.jsx)(a.a.StrictMode,{children:Object(p.jsx)(D,{})})}),document.getElementById("root"))}},[[216,1,2]]]);
//# sourceMappingURL=main.84576308.chunk.js.map