(this["webpackJsonpreact-training"]=this["webpackJsonpreact-training"]||[]).push([[0],{213:function(e,t,r){},214:function(e,t,r){},215:function(e,t,r){},216:function(e,t,r){"use strict";r.r(t);var a=r(0),c=r.n(a),s=r(32),n=r.n(s),i=r(5),o=r(85),l=r(3),u=r(2),d=r(79),j=r.n(d).a.create({baseURL:"https://bdeilhot-react.herokuapp.com",headers:{Accept:"application/json","Content-Type":"application/json"}});function b(e){if(e.status>=200&&e.status<300)return e;var t=new Error("HTTP Error ".concat(e.statusText));throw console.log(t),t}function O(e){return e.data}var h={getUsers:function(e){return j.get("/users").then(b).then(O).then(e)},getStories:function(e){return j.get("/stories").then(b).then(O).then(e)},createStory:function(e){return j.post("/stories",e).then(b)},createUserAndStory:function(e){j.post("/users",e.user).then(b),j.post("/stories",e.story).then(b)},deleteStory:function(e){return j.delete("/stories?id=eq.".concat(e)).then(b)},updateStory:function(e){return j.put("/stories?id=eq.".concat(e.id),e).then(b)}};var m=Object(o.a)((function(e,t){switch(t.type){case"FETCH_STORIES_SUCCESS":return Object(u.a)(Object(u.a)({},e),{},{stories:t.payload,loading:!1});case"FETCH_USER_SUCCESS":return Object(u.a)(Object(u.a)({},e),{},{users:t.payload});case"ADD_STORY":return h.createStory(t.story),Object(u.a)(Object(u.a)({},e),{},{stories:[].concat(Object(l.a)(e.stories),[t.story]),updateArticles:!0});case"CREATE_USER_AND_STORY":return h.createUserAndStory(t),Object(u.a)(Object(u.a)({},e),{},{users:[].concat(Object(l.a)(e.users),[t.user]),stories:[].concat(Object(l.a)(e.stories),[t.story]),updateArticles:!0});case"REMOVE_STORY":var r=e.stories.findIndex((function(e){return e.id===t.story.id}));return e.stories.splice(r,1),Object(u.a)(Object(u.a)({},e),{},{stories:Object(l.a)(e.stories)});case"UPDATE_STORY":var a=e.stories.findIndex((function(e){return e.id===t.story.id}));return e.stories.splice(a,1,t.story),h.updateStory(t.story),Object(u.a)(Object(u.a)({},e),{},{stories:Object(l.a)(e.stories)});case"STOP_ARTICLE_UPDATE":return Object(u.a)(Object(u.a)({},e),{},{updateArticles:!1});case"SEARCH_OPTION_CHANGE":return Object(u.a)(Object(u.a)({},e),{},{searchOption:t.payload});case"SEARCH_VALUE_CHANGE":return Object(u.a)(Object(u.a)({},e),{},{searchValue:t.payload});default:return e}}),{users:[],stories:[],updateArticles:!1,loading:!0,searchOption:"title",searchValue:""}),x=r(16),f=r.n(x),p=r(1),y=function(e){var t=e.name,r=e.picture,a=e.joined;return Object(p.jsxs)("div",{className:"col-2-30 avatar",children:[Object(p.jsxs)("div",{children:[Object(p.jsx)("img",{src:r,alt:"Avatar"}),Object(p.jsx)("span",{children:t})]}),Object(p.jsx)("div",{className:"meta",children:Object(p.jsxs)("p",{children:["Joined ",f()(a).fromNow()]})})]})},v=r(33),S=r(6),g=r(9),N=function(e){var t=e.id,r=e.title,c=e.story,s=e.created,n=e.edited,o=e.author,l=Object(i.b)(),d=Object(a.useState)(!1),j=Object(S.a)(d,2),b=j[0],O=j[1],m=Object(a.useState)(!1),x=Object(S.a)(m,2),y=x[0],N=x[1],E=Object(a.useState)({title:r,story:c}),C=Object(S.a)(E,2),A=C[0],T=C[1],_=Object(a.useState)(null),R=Object(S.a)(_,2),L=R[0],U=R[1],w=Object(a.useState)(null),D=Object(S.a)(w,2),H=D[0],q=D[1],F=new Date,I=g.a({title:g.b().min(5,"Must be at least 5 characters").max(50,"Must be 50 characters or less").required("Title is required"),story:g.b().min(30,"Must be 30 characters or more").required("Story is required")});return Object(p.jsxs)("div",{className:"col-2-70 story",children:[Object(p.jsxs)("div",{className:"title",children:[!0===y?Object(p.jsx)("input",{type:"text",value:A.title,onChange:function(e){var t=e.target.value;return T({title:t,story:A.story})},className:"input ".concat(null===L?"":"error-border")}):Object(p.jsx)("h2",{children:r}),Object(p.jsx)("p",{className:"error-message",children:null===L?null:L})]}),Object(p.jsxs)("div",{className:"message",children:[!0===y?Object(p.jsx)("textarea",{value:A.story,onChange:function(e){var t=e.target.value;return T({title:A.title,story:t})},className:"textarea ".concat(null===H?"":"error-border")}):Object(p.jsx)("p",{children:c}),Object(p.jsx)("p",{className:"error-message",children:null===H?null:H})]}),Object(p.jsxs)("div",{className:"article-footer meta",children:[Object(p.jsxs)("p",{children:[n===s?"Created ".concat(f()(s).fromNow()):"Edited ".concat(f()(n).fromNow())," "]}),Object(p.jsx)("button",{onClick:function(){!0!==y?N(!1===y):I.validate({title:A.title,story:A.story},{abortEarly:!1}).catch((function(e){var t=e.inner.map((function(e){return[e.path,e.message]})).reduce((function(e,t){var r=Object(S.a)(t,2),a=r[0],c=r[1];return Object(u.a)(Object(u.a)({},e),{},Object(v.a)({},a,a in e?[].concat(e[a],c):[c]))}),{}),r=t.title?t.title.join(" and ").toString():null,a=t.story?t.story.join(" and ").toString():null;U(r),q(a)})).then((function(e){e&&(U(null),q(null),l({type:"UPDATE_STORY",story:{id:t,title:A.title,story:{story:A.story},created:s,edited:F,author:o}}),N(!1===y))}))},className:"bt bt-left ".concat(!0===y?"bt-active":""),children:"Edit"}),Object(p.jsx)("button",{onClick:function(){O(!1===b)},className:"bt bt-right",children:"Delete"})]}),!0===b?Object(p.jsxs)("div",{className:"delete-confirm",children:[Object(p.jsx)("p",{children:"Are you sure?"}),Object(p.jsxs)("div",{children:[Object(p.jsx)("button",{onClick:function(){h.deleteStory(t),l({type:"REMOVE_STORY",story:{id:t}}),O(!1)},className:"bt bt-left",children:"Yes"}),Object(p.jsx)("button",{onClick:function(){return O(!1)},className:"bt bt-right",children:"No"})]})]}):null]})},E=(r(213),function(e){var t=e.id,r=e.title,a=e.author,c=e.story,s=e.created,n=e.edited,o=Object(i.c)((function(e){return e.users})).filter((function(e){return e.id===a})),l=Object(u.a)({},o[0]);return Object(p.jsxs)("div",{className:"article",children:[Object(p.jsx)(y,{name:l.name,picture:l.picture,joined:l.joined}),Object(p.jsx)(N,{id:t,title:r,story:c,created:s,edited:n,author:a})]})}),C=function(){return Object(p.jsx)("div",{className:"loading",children:Object(p.jsxs)("div",{className:"lds-ellipsis",children:[Object(p.jsx)("div",{}),Object(p.jsx)("div",{}),Object(p.jsx)("div",{}),Object(p.jsx)("div",{})]})})},A=function(){var e=Object(i.b)(),t=Object(i.c)((function(e){return e.users})),r=Object(i.c)((function(e){return e.stories})),c=Object(i.c)((function(e){return e.updateArticles})),s=Object(i.c)((function(e){return e.loading})),n=Object(i.c)((function(e){return e.searchOption})),o=Object(i.c)((function(e){return e.searchValue}));Object(a.useEffect)((function(){function t(){h.getStories((function(t){return e({type:"FETCH_STORIES_SUCCESS",payload:t})})),h.getUsers((function(t){return e({type:"FETCH_USER_SUCCESS",payload:t})}))}t(),console.log("articles loaded");var r=setInterval(t,5e3);return e({type:"STOP_ARTICLE_UPDATE"}),function(){return clearInterval(r)}}),[e,c]);var l=t.filter((function(e){return e.name.toLocaleLowerCase().includes(o.toLocaleLowerCase())})),d=""===o?r.sort((function(e,t){return t.created>e.created?1:-1})).map((function(e){return Object(p.jsx)(E,{id:e.id,title:e.title,author:e.author,story:e.story.story,created:e.created,edited:e.edited},e.id)})):r.sort((function(e,t){return t.created>e.created?1:-1})).filter("title"===n?function(e){return e.title.toLocaleLowerCase().includes(o.toLocaleLowerCase())}:function(e){return e.author===Object(u.a)({},l[0]).id}).map((function(e){return Object(p.jsx)(E,{id:e.id,title:e.title,author:e.author,story:e.story.story,created:e.created,edited:e.edited},e.id)}));return Object(p.jsxs)(p.Fragment,{children:[s?Object(p.jsx)(C,{}):null,Object(p.jsx)("div",{className:"article-list",children:d})]})},T=r(8),_=function(){var e=Object(i.b)(),t=Object(i.c)((function(e){return e.users})),r=Object(i.c)((function(e){return e.stories})),c=Object(a.useState)(!0),s=Object(S.a)(c,2),n=s[0],o=s[1],l=new Date,d={username:"",avatar:"",title:"",story:""};function j(e){if(t.find((function(t){return t.name.toLocaleLowerCase()===e.toLocaleLowerCase()}))){var r=t.filter((function(t){return t.name.toLocaleLowerCase()===e.toLocaleLowerCase()}));return Object(u.a)({},r[0])}return!1}function b(){return t.length+1}function O(){return 0===r.length?1:r[0].id+1}function h(){o(!n)}return Object(p.jsx)(T.d,{initialValues:d,validationSchema:g.a({username:g.b().min(2,"Must be at least 2 characters long").max(15,"Must be 15 characters or less").required("Username is required"),avatar:g.b().url("Avatar must be a valid URL"),title:g.b().min(5,"Must be at least 5 characters").max(50,"Must be 50 characters or less").required("Title is required"),story:g.b().min(30,"Must be 30 characters or more").required("Story is required")}),onSubmit:function(t,r){var a=r.setSubmitting,c=r.resetForm;setTimeout((function(){var r=j(t.username);e(r?{type:"ADD_STORY",story:{id:O(),title:t.title,author:r.id,story:{story:t.story},created:l,edited:l}}:{type:"CREATE_USER_AND_STORY",user:{id:b(),name:t.username,picture:""===t.avatar?"https://brunodeilhot.github.io/Astrology/assets/background.png":t.avatar,joined:l},story:{id:O(),title:t.title,author:b(),story:{story:t.story},created:l,edited:l}}),a(!1),h(),c()}),400)},children:function(e){var t=e.isSubmitting,r=e.setFieldValue;return Object(p.jsxs)("div",{className:"article-form-group",children:[Object(p.jsxs)("div",{className:"article-header",children:[Object(p.jsx)("h2",{children:"Create a story"}),Object(p.jsx)("button",{onClick:h,children:Object(p.jsx)("i",{className:n?"gg-chevron-down":"gg-chevron-up"})})]}),n?null:Object(p.jsxs)(T.c,{className:"article-form",children:[Object(p.jsxs)("div",{className:"row",children:[Object(p.jsxs)("div",{className:"col-2-30",children:[Object(p.jsx)("label",{htmlFor:"username",children:"Username"}),Object(p.jsx)(T.b,{name:"username",children:function(e){var t=e.field,a=e.meta,c=a.touched,s=a.error;return Object(p.jsx)("input",Object(u.a)({onKeyUp:function(e){!function(e){var t=j(e.target.value);t&&(d.avatar=t.picture)}(e),r("avatar",d.avatar,!0)},placeholder:"Your name is..",type:"text",className:c&&s?"input error-border":"input"},t))}}),Object(p.jsx)(T.a,{className:"error-message",name:"username",component:"div"}),Object(p.jsx)("label",{htmlFor:"avatar",children:"Avatar"}),Object(p.jsx)(T.b,{name:"avatar",children:function(e){var t=e.field,r=e.meta,a=r.touched,c=r.error;return Object(p.jsx)("input",Object(u.a)({placeholder:"Link to an image..",type:"text",className:a&&c?"input error-border":"input"},t))}}),Object(p.jsx)(T.a,{className:"error-message",name:"avatar",component:"div"})]}),Object(p.jsxs)("div",{className:"col-2-70",children:[Object(p.jsx)("label",{htmlFor:"title",children:"Title"}),Object(p.jsx)(T.b,{name:"title",children:function(e){var t=e.field,r=e.meta,a=r.touched,c=r.error;return Object(p.jsx)("input",Object(u.a)({placeholder:"The main subject of your story..",type:"text",className:a&&c?"input error-border":"input"},t))}}),Object(p.jsx)(T.a,{className:"error-message",name:"title",component:"div"}),Object(p.jsx)("label",{htmlFor:"story",children:"Story"}),Object(p.jsx)(T.b,{name:"story",children:function(e){var t=e.field,r=e.meta,a=r.touched,c=r.error;return Object(p.jsx)("textarea",Object(u.a)({placeholder:"Write to your hearth's delight..",className:a&&c?"textarea error-border":"textarea"},t))}}),Object(p.jsx)(T.a,{className:"error-message",name:"story",component:"div"})]})]}),Object(p.jsx)("button",{type:"submit",disabled:t,children:"Add Story"})]})]})}})},R=function(){var e=Object(i.b)();return Object(p.jsxs)("div",{className:"search",children:[Object(p.jsxs)("select",{onChange:function(t){e({type:"SEARCH_OPTION_CHANGE",payload:t.target.value})},className:"search-select",children:[Object(p.jsx)("option",{value:"title",children:"Title"}),Object(p.jsx)("option",{value:"author",children:"Author"})]}),Object(p.jsx)("div",{children:Object(p.jsx)("i",{className:"gg-search"})}),Object(p.jsx)("input",{onChange:function(t){e({type:"SEARCH_VALUE_CHANGE",payload:t.target.value})},className:"input",type:"text"})]})},L=(r(214),function(){return Object(p.jsxs)("div",{className:"dashboard",children:[Object(p.jsx)(_,{}),Object(p.jsx)(R,{}),Object(p.jsx)(A,{})]})}),U=(r(215),function(){return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{className:"header",children:Object(p.jsx)("h1",{children:"Share your story!"})}),Object(p.jsx)(L,{}),Object(p.jsx)("div",{className:"footer",children:Object(p.jsxs)("p",{children:["Designed and built by Bruno Deilhot \xa9 ",f()().year()]})})]})});n.a.render(Object(p.jsx)(i.a,{store:m,children:Object(p.jsx)(c.a.StrictMode,{children:Object(p.jsx)(U,{})})}),document.getElementById("root"))}},[[216,1,2]]]);
//# sourceMappingURL=main.e6f8c6df.chunk.js.map